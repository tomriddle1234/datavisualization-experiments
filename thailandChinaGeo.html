<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"> 
        <title>GeoTest</title> 
        <script src="js/d3.min.js" charset="utf-8"></script> 
        <script src="js/d3.geo.projection.min.js" charset="utf-8"></script>
        <script src="js/topojson.min.js" charset="utf-8"></script>
        
<!--        <link href="css/style.css" type="text/css" rel="stylesheet" \>-->
        <style>
            .subunit.CHH { fill: #fb8072; }
            .subunit.CHI { fill: #fb8072; }
            .subunit.CHN { fill: #fb8072; }
            .subunit.TWN { fill: #fb8072; }
            .subunit.HKG { fill: #fb8072; }
            .subunit.THA { fill: #7489cf; }
        </style>
    </head>
    <body>
        <script>
       
        var width = 1000,
	    height = 1000;
	    
	    
	    //albers is not working
	    var projection = d3.geo.mercator()
	        .center([107, 31])
            .scale(850)
            .translate([width/2, height/2]);
	       
//	    var projection = d3.geo.albers()
//	        .center([115, 39]) // 115W 39N is about beijing
//	        .rotate([0,0, 10])
//	        .parallels([14, 52])
//	        ;
	    
	    var path = d3.geo.path()
	        .projection(projection) ;

        // draw svg
        var svg = d3.select("body").append("svg")
	        .attr("width", width)
	        .attr("height", height);


        d3.json("json/thailand_china_prep_map_with_places.json", function(error, mapdata) {
          
            if (error) return console.error(error) ;
            svg.selectAll(".subunit")
                .data(topojson.feature(mapdata, mapdata.objects.china_thailand_subunits).features)
                .enter().append("path")
                .attr("class", function(d) { console.log(d.id) ; return "subunit " + d.id ;})
                .attr("d", path) 
                ;
            svg.append("path")
                .datum(topojson.feature(mapdata,mapdata.objects.cn_places))
                .attr("d",path)
                .attr("class","place") ;
            
            svg.append("path")
                .datum(topojson.feature(mapdata,mapdata.objects.th_places))
                .attr("d",path)
                .attr("class","place") ;
            svg.append("path")
                .datum(topojson.feature(mapdata,mapdata.objects.tw_places))
                .attr("d",path)
                .attr("class","place") ;
            svg.append("path")
                .datum(topojson.feature(mapdata,mapdata.objects.hk_places))
                .attr("d",path)
                .attr("class","place") ;
                  
            
            svg.selectAll(".place-label")
                .data(d3.merge([topojson.feature(mapdata,mapdata.objects.cn_places).features ,  topojson.feature(mapdata,mapdata.objects.tw_places).features , topojson.feature(mapdata,mapdata.objects.th_places).features]))
               
                .enter().append("text")
                .attr("class","place-label")
                .attr("transform", function(d) { return "translate(" + projection(d.geometry.coordinates) + ")"; })
      .attr("x", function(d) { return d.geometry.coordinates[0] > -1 ? 6 : -6; })
      .attr("dy", ".35em")
      .style("text-anchor", function(d) { return d.geometry.coordinates[0] > -1 ? "start" : "end"; })
      .text(function(d) { return d.properties.name; });
      
      
              
        }) ;
              
         //var bankock = [13.736717,100.523186] ;
         //var beijing = [39.913818,	116.363625] ;
         /*var bankock = [100,  100] ;
         var beijing = [55,	55] ;
         console.log(projection(bankock), projection(beijing)) ;
         
         svg.selectAll("circle")
            .data([bankock,beijing]).enter()
            .append("circle")
            .attr("cx", function (d) { console.log(projection(d)); return projection(d)[0]; })
		    .attr("cy", function (d) { return projection(d)[1]; })
		    .attr("r", "8px")
		    .attr("fill", "red")
        });
        */
        </script>
    </body>
    
</html>
